<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <title>VR-05</title>
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="https://d3js.org/d3-selection-multi.v0.4.min.js"></script>
  <script src="https://aframe.io/releases/0.2.0/aframe.min.js"></script>
  <script src="https://rawgit.com/ngokevin/aframe-text-component/master/dist/aframe-text-component.min.js"></script>
  <style>
    body { margin:0;position:fixed;top:0;right:0;bottom:0;left:0; }
  </style>
</head>

<body>
  <a-scene vr-mode-ui="enabled: false">
    <a-sky color="black" radius="1000"></a-sky>
    <!--<a-plane color="grey" opacity="0.1" height="100" width="100" rotation="-90 0 0" position="6 0 4"></a-plane>-->
    <a-light type="directional" color="#FFF" intensity="0.45" position="4 2 1"></a-light>
    <a-light type="ambient" color="#A8A8A8"></a-light>
    <a-camera id="camera" near=".5" far="4000" position="220 300 217" fov="2"
              rotation="-45 45 0" wasd-controls-enabled="false"
              look-controls-enabled="false"></a-camera>
    <a-cursor color="#2E3A87">
  </a-scene>
</body>

<script>

  var spread = 3

  // make data
  var numbers = [];
  for (var i = 1; i <= 25; i++) {
     numbers.push(i);
  };

  var scene = d3.select("a-scene");

  function update(data) {
    var t = d3.transition()
        .duration(8000)
        .ease(d3.easeLinear);

    // DATA JOIN
    // Join new data with old emements, if any
    var shapes = scene.selectAll("a-box").data(data, function(d) { return d; });

    // EXIT
    // Remove old elements as needed.
    shapes.exit()
          .attr("class", "exit")
        .transition(t)
          .attrs({
            height: 1,
            opacity: 0.01,
            color: "black"
            })
            .attrTween("position", function(d, i){
                var u = this.getAttribute("position").x,
                    v = this.getAttribute("position").z,
                    h = map(d, 1, 25, .1, 5);
                return d3.interpolateObject({x:u, y:h/2, z:v}, {x:u, y:-d, z:v})
            })
          .remove();

    // UPDATE
    // Update old elements as needed.
    shapes.attr("class", "update")
        .attrs({
          opacity: .9
          })
        .transition(t)
          .attr("color", "white")
          .attrTween("position", function(d, i){
              var j = this.getAttribute("position"),
                  h = map(d, 1, 25, .1, 5),
                  u = spread * Math.ceil((i+1)/5),
                  v = spread * ((i+1) % 5);
              return d3.interpolateObject(j,{x:u, y:h/2, z:v})
            });

    // ENTER
    // Create new elements as needed
    shapes.enter().append("a-box")
          .attrs({
              class: "enter",
              depth: 1,
              height: 1,
              width: 1,
              opacity: 0.01,
              color: "#505050"
            })
          .transition(t)
            .attrs({
                opacity: .9,
                height: function(d) {return map(d, 1, 25, .1, 5)}
              })
            .attrTween("position", function(d, i){
                var u = spread * Math.ceil((i+1)/5),
                    v = spread * ((i+1) % 5),
                    h = map(d, 1, 25, .1, 5);
                return d3.interpolateObject({x:u, y:d, z:v},{x:u, y:h/2, z:v})
              });
    }

  // The initial display
  update(numbers)

  d3.interval(function() {
        var sample = d3.shuffle(numbers).slice(0, Math.floor(Math.random()*25))
        //.sort(function(a, b) {return a - b});
        update(sample);
    }, 10000);

    function map(value, low1, high1, low2, high2) {
        return low2 + (high2 - low2) * (value - low1) / (high1 - low1);
    }
</script>
