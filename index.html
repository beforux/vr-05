<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <title>VR-05</title>
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="https://d3js.org/d3-selection-multi.v0.4.min.js"></script>
  <script src="https://aframe.io/releases/0.2.0/aframe.min.js"></script>
  <style>
    body { margin:0;position:fixed;top:0;right:0;bottom:0;left:0; }
  </style>
</head>

<body>
  <a-scene vr-mode-ui="enabled: false">
    <a-sky color="black" radius="1000"></a-sky>
    <!--<a-plane color="grey" opacity="0.1" height="100" width="100" rotation="-90 0 0" position="6 0 4"></a-plane>-->
    <a-light type="directional" color="#FFF" intensity="0.45" position="4 2 1"></a-light>
    <a-light type="ambient" color="#A8A8A8"></a-light>
    <a-camera id="camera" near=".5" far="4000" position="220 300 217" fov="2"
              rotation="-45 45 0" wasd-controls-enabled="false"
              look-controls-enabled="false"></a-camera>
  </a-scene>
</body>

<script>
  var spread = 3;
  // make data
  var numbers = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25];

  var scene = d3.select("a-scene");

  function update(data) {
    var t = d3.transition()
        .duration(5000)
        .ease(d3.easeLinear);

    // DATA JOIN
    // Join new data with old emements, if any
    var shapes = scene.selectAll("a-box").data(data, function(d) { return d; });

    // EXIT
    // Remove old elements as needed.
    shapes.exit()
        .transition(t)
          .attrs({
            height: 1,
            opacity: 0.01,
            color: "#262626"
            })
            .attrTween("position", function(d, i){
                var u = this.getAttribute("position").x,
                    v = this.getAttribute("position").z,
                    k = this.getAttribute("position").y;
                return d3.interpolateObject({x:u, y:k, z:v}, {x:u, y:-d, z:v})
            })
          .remove();

    // UPDATE
    // Update old elements as needed.
    shapes.transition(t)
          .attr("color", "#737373")
          .attrTween("position", function(d, i){
              var j = this.getAttribute("position"),
                  k = this.getAttribute("position").y,
                  u = spread * Math.ceil((i+1)/5),
                  v = spread * ((i+1) % 5);
              return d3.interpolateObject(j,{x:u, y:k, z:v})
            });

    // ENTER
    // Create new elements as needed
    shapes.enter().append("a-box")
          .attrs({
              depth: 1,
              height: 1,
              width: 1,
              opacity: 0.01,
              color: "#262626"
            })
          .transition(t)
            .attrs({
                opacity: 1,
                height: function(d) {return map(d, .1, 3)}
              })
            .attrTween("position", function(d, i){
                var u = spread * Math.ceil((i+1)/5),
                    v = spread * ((i+1) % 5),
                    h = map(d, .1, 5);
                return d3.interpolateObject({x:u, y:d, z:v},{x:u, y:h/2, z:v})
              });
    }

  // The initial display
  update(numbers)

  d3.interval(function() {
        var sample = d3.shuffle(numbers).slice(0, Math.floor(Math.random()*25))
        //.sort(function(a, b) {return a - b});
        update(sample);
    }, 10000);

  function map(value, low2, high2) {
      return low2 + (high2 - low2) * (value - 1) / (24);
  }
</script>
